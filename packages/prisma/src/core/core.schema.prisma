generator client {
    provider      = "prisma-client"
    output        = "../generated/client-core"
    binaryTargets = [env("PRISMA_BINARY")]
    runtime       = "bun"
}

datasource db {
    provider = "postgresql"
    url      = env("CORE_DATABASE_URL")
}

model Permisos {
    id        Int      @id @default(autoincrement())
    read      Boolean? @default(false) @map("leer")
    write     Boolean? @default(false) @map("escribir")
    view      Boolean? @default(false) @map("ver")
    update    Boolean? @default(false) @map("editar")
    delete    Boolean? @default(false) @map("eliminar")
    print     Boolean? @default(false) @map("imprimir")
    report    Boolean? @default(false) @map("reporte")
    menuId    Int      @map("menu_id")
    usuarioId Int      @map("usuario_id")
    tenantId  Int      @map("tenant_id")
    Menu      Menu     @relation(fields: [menuId], references: [id])
    Usuarios  Usuarios @relation(fields: [usuarioId], references: [id])
    Tenant    Tenant   @relation(fields: [tenantId], references: [id])

    @@unique([menuId, usuarioId, tenantId], map: "usuarios_menu_unique_index")
}

model Usuarios {
    id             Int              @id @default(autoincrement())
    email          String           @unique @map("correo") @db.VarChar(50)
    username       String           @unique @map("usuario") @db.VarChar(20)
    password       String
    firstName      String           @map("nombre") @db.VarChar(100)
    lastName       String           @map("apellido") @db.VarChar(100)
    changePassword Boolean?         @default(false) @map("cambiar_password")
    status         Boolean?         @default(true) @map("activo")
    permission     Permisos[]
    UsuariosApps   UsuariosApps[]
    UsuariosTenant UsuariosTenant[]
}

model Menu {
    id          Int        @id @default(autoincrement())
    title       String     @map("titulo")
    endpoint    String     @unique
    frontPath   String
    description String?    @map("descripcion")
    ancestorId  Int?       @map("menu_padre")
    read        Boolean?   @default(false) @map("leer")
    write       Boolean?   @default(false) @map("escribir")
    view        Boolean?   @default(false) @map("ver")
    update      Boolean?   @default(false) @map("editar")
    delete      Boolean?   @default(false) @map("eliminar")
    print       Boolean?   @default(false) @map("imprimir")
    report      Boolean?   @default(false) @map("reporte")
    status      Boolean?   @default(true) @map("activo")
    position    Int?       @default(0) @map("posicion")
    appId       Int        @map("app_id")
    app         Apps       @relation(fields: [appId], references: [id])
    icon        String?    @map("icono")
    ancestor    Menu?      @relation("MenuToMenu", fields: [ancestorId], references: [id], map: "ancestor___fk")
    Menu_Menu   Menu[]     @relation("MenuToMenu")
    permission  Permisos[]
}

model Apps {
    id           Int            @id @default(autoincrement())
    name         String         @unique @map("nombre")
    description  String?        @map("descripcion")
    icon         String?        @map("icono")
    url          String         @unique
    status       Boolean?       @default(true) @map("activo")
    color        String?
    UsuariosApps UsuariosApps[]
    Menu         Menu[]
}

model Tenant {
    id           Int              @id @default(autoincrement())
    name         String           @unique @map("nombre")
    status       Boolean?         @default(true) @map("activo")
    users        UsuariosTenant[]
    permission   Permisos[]
    usuariosApps UsuariosApps[]
}

model UsuariosApps {
    userId     Int      @map("usuario_id")
    appId      Int      @map("app_id")
    tenantId   Int      @map("tenant_id")
    assignedAt DateTime @default(now()) @map("asignado_en")
    user       Usuarios @relation(fields: [userId], references: [id])
    app        Apps     @relation(fields: [appId], references: [id])
    tenant     Tenant   @relation(fields: [tenantId], references: [id])

    @@id([userId, appId, tenantId])
}

model UsuariosTenant {
    userId    Int      @map("usuario")
    tenantId  Int      @map("tenant")
    createdAt DateTime @default(now()) @map("fecha")
    tenant    Tenant   @relation(fields: [tenantId], references: [id])
    user      Usuarios @relation(fields: [userId], references: [id])

    @@id([userId, tenantId])
}

model Logs {
    id       Int       @id @default(autoincrement())
    endpoint String
    action   Actions   @map("accion")
    date     DateTime? @default(now()) @map("fecha")
    persist  Boolean?  @default(true) @map("persistir")
    resp     String
    username String    @map("usuario")
}

enum Actions {
    guardar
    editar
    eliminar
    consultar
}
